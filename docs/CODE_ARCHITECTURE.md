# è‡ªå‹•ãƒ¢ã‚¶ã‚¨ã‚» v1.0 - ã‚³ãƒ¼ãƒ‰æ§‹æˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“‹ æ¦‚è¦

è‡ªå‹•ãƒ¢ã‚¶ã‚¨ã‚» v1.0ã¯ã€ã‚¢ãƒ‹ãƒ¡ãƒ»ã‚¤ãƒ©ã‚¹ãƒˆç”»åƒã®ç”·å¥³å±€éƒ¨ã‚’è‡ªå‹•æ¤œå‡ºã—ã¦ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚’é©ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚YOLOæ¤œå‡º + SAMåˆ†å‰²ã®é«˜ç²¾åº¦å‡¦ç†ã«ã‚ˆã‚Šã€è‡ªç„¶ãªä»•ä¸ŠãŒã‚Šã‚’å®Ÿç¾ã—ã€FANZAåŸºæº–å¯¾å¿œã®å®‰å…¨ãªãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚’æä¾›ã—ã¾ã™ã€‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‰æ§‹æˆã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è©³ç´°å®Ÿè£…ã€ãŠã‚ˆã³é–‹ç™ºè€…å‘ã‘APIä»•æ§˜ã«ã¤ã„ã¦åŒ…æ‹¬çš„ã«è§£èª¬ã—ã¾ã™ã€‚

### ğŸ†• v1.0ã®ä¸»è¦æ©Ÿèƒ½
- **çµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ + Discordèªè¨¼ã®çµ±ä¸€ç®¡ç†
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«å¯¾å¿œ**: ä»»æ„ã®YOLOå½¢å¼.ptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒ æ¤œå‡ºå™¨ã¨ã—ã¦è¿½åŠ å¯èƒ½
- **é…å»¶ãƒ­ãƒ¼ãƒ€ãƒ¼**: exeåŒ–æ™‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- **æš—å·åŒ–è¨­å®šç®¡ç†**: é…å¸ƒç‰ˆã§ã®èªè¨¼æƒ…å ±å®‰å…¨ç®¡ç†
- **æŸ”è»Ÿãªãƒ¢ãƒ‡ãƒ«æ¤œç´¢**: è¤‡æ•°å ´æ‰€ã‹ã‚‰ã®ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•æ¤œå‡º

### ğŸ¯ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´
- **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ**: æ©Ÿèƒ½åˆ¥ã«åˆ†é›¢ã•ã‚ŒãŸç‹¬ç«‹æ€§ã®é«˜ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ
- **çµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: Discordèªè¨¼ã¨æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã®çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **ãƒãƒ«ãƒãƒ¢ãƒ‡ãƒ«å¯¾å¿œ**: YOLOv8ã€NudeNetã€SAMã®è¤‡æ•°AIæŠ€è¡“ã‚’çµ±åˆ
- **é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¶å¾¡**: é…å¸ƒç‰ˆã¨é–‹ç™ºç‰ˆã®å‹•çš„æ©Ÿèƒ½åˆ‡ã‚Šæ›¿ãˆ

---

## ğŸ—ï¸ å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è‡ªå‹•ãƒ¢ã‚¶ã‚¨ã‚» v3.0                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ–¥ï¸ ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤                                      â”‚
â”‚  â”œâ”€â”€ GUI (gui.py)                                           â”‚
â”‚  â”œâ”€â”€ çµ±åˆèªè¨¼UI (auth_manager.py)                           â”‚
â”‚  â””â”€â”€ è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚° (å„ç¨®è¨­å®šUI)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å±¤                                       â”‚
â”‚  â”œâ”€â”€ çµ±åˆèªè¨¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (auth_manager.py)                  â”‚
â”‚  â”œâ”€â”€ Discordèªè¨¼ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ (discord_auth_adapter.py)        â”‚
â”‚  â”œâ”€â”€ æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ (auth.py)                             â”‚
â”‚  â”œâ”€â”€ èªè¨¼è¨­å®šç®¡ç† (auth_config.py)                          â”‚
â”‚  â””â”€â”€ æš—å·åŒ–è¨­å®š (encrypted_config.py)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ§  AIå‡¦ç†å±¤                                                 â”‚
â”‚  â”œâ”€â”€ ãƒãƒ«ãƒãƒ¢ãƒ‡ãƒ«æ¤œå‡ºå™¨ (detector.py)                        â”‚
â”‚  â”œâ”€â”€ NudeNetæ¤œå‡ºå™¨ (nudenet_detector.py)                   â”‚
â”‚  â”œâ”€â”€ SAMã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (segmenter.py)                   â”‚
â”‚  â””â”€â”€ ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³ (mosaic.py)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¦ ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å±¤                                 â”‚
â”‚  â”œâ”€â”€ ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ (downloader.py)                    â”‚
â”‚  â”œâ”€â”€ é…å»¶èª­ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ  (lazy_loader.py)                  â”‚
â”‚  â”œâ”€â”€ å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (utils.py)                           â”‚
â”‚  â””â”€â”€ ç’°å¢ƒè¨­å®šç®¡ç† (env_config.py)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”»åƒå…¥åŠ›  â”‚ â†’ â”‚ AIæ¤œå‡ºå‡¦ç† â”‚ â†’ â”‚ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼â”‚ â†’ â”‚ãƒ¢ã‚¶ã‚¤ã‚¯é©ç”¨â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ã‚·ãƒ§ãƒ³å‡¦ç†  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“                              â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èªè¨¼ç¢ºèª  â”‚    â”‚ ãƒ¢ãƒ‡ãƒ«é¸æŠ â”‚    â”‚ ãƒã‚¹ã‚¯ç”Ÿæˆ â”‚    â”‚ å‡ºåŠ›ä¿å­˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ è©³ç´°

```
auto_mosaic/
â”œâ”€â”€ auto_mosaic/                    # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ __init__.py                 # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–ã€PyTorchè¨­å®š
â”‚   â”œâ”€â”€ __main__.py                 # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ src/                        # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”‚       â”œâ”€â”€ __init__.py             # srcãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”‚       â”‚
â”‚       # ğŸ” èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 
â”‚       â”œâ”€â”€ auth_config.py          # çµ±åˆèªè¨¼è¨­å®šç®¡ç†ï¼ˆä¸­æ ¸ï¼‰
â”‚       â”œâ”€â”€ auth_manager.py         # çµ±åˆèªè¨¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
â”‚       â”œâ”€â”€ auth.py                 # æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼äº’æ›ï¼‰
â”‚       â”œâ”€â”€ discord_auth_adapter.py # Discord OAuth2èªè¨¼ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
â”‚       â”œâ”€â”€ encrypted_config.py     # æš—å·åŒ–è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
â”‚       â”œâ”€â”€ env_config.py           # ç’°å¢ƒå¤‰æ•°ãƒ»è¨­å®šç®¡ç†
â”‚       â”‚
â”‚       # ğŸ§  AIãƒ»ç”»åƒå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ 
â”‚       â”œâ”€â”€ detector.py             # ãƒãƒ«ãƒãƒ¢ãƒ‡ãƒ«æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ 
â”‚       â”œâ”€â”€ nudenet_detector.py     # NudeNetå°‚ç”¨æ¤œå‡ºå™¨
â”‚       â”œâ”€â”€ segmenter.py            # SAMã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
â”‚       â”œâ”€â”€ mosaic.py               # ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
â”‚       â”‚
â”‚       # ğŸ–¥ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚       â”œâ”€â”€ gui.py                  # ãƒ¡ã‚¤ãƒ³GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚       â”‚
â”‚       # ğŸ“¦ ã‚µãƒãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ 
â”‚       â”œâ”€â”€ downloader.py           # ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼
â”‚       â”œâ”€â”€ lazy_loader.py          # é…å»¶èª­ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ 
â”‚       â””â”€â”€ utils.py                # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚
â”œâ”€â”€ config/                         # è¨­å®šãƒ»èªè¨¼ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ auth.dat                    # æš—å·åŒ–èªè¨¼ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ auth.salt                   # æš—å·åŒ–ã‚½ãƒ«ãƒˆ
â”‚   â””â”€â”€ discord_auth/               # Discordèªè¨¼ãƒ‡ãƒ¼ã‚¿
â”‚
â”œâ”€â”€ models/                         # AIãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ anime_nsfw_v4/              # Anime NSFW Detection v4.0
â”‚
â”œâ”€â”€ nudenet_models/                 # NudeNetãƒ¢ãƒ‡ãƒ«
â”‚
â””â”€â”€ logs/                          # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ğŸš€ 1. `__main__.py` - ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ

**ç›®çš„**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ

```python
def main():
    """Main entry point for è‡ªå‹•ãƒ¢ã‚¶ã‚¨ã‚»"""
```

**ä¸»è¦æ©Ÿèƒ½**:
- GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
- ä¾å­˜é–¢ä¿‚ã®ç¢ºèª
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ä½¿ç”¨æ–¹æ³•**:
```bash
python -m auto_mosaic
```

---

### ğŸ›ï¸ 2. `__init__.py` - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–

**ç›®çš„**: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®åˆæœŸåŒ–ã¨PyTorchäº’æ›æ€§ã®è¨­å®š

**ä¸»è¦æ©Ÿèƒ½**:
- Python 3.10+ã®è¦ä»¶ãƒã‚§ãƒƒã‚¯
- PyTorchã®weights_onlyè­¦å‘Šã®ç„¡åŠ¹åŒ–
- ã‚°ãƒ­ãƒ¼ãƒãƒ«torch.loadã®ãƒ‘ãƒƒãƒé©ç”¨

**é‡è¦ãªè¨­å®š**:
```python
# PyTorchäº’æ›æ€§è¨­å®š
os.environ["PYTORCH_WEIGHTS_ONLY"] = "false"
torch.serialization._weights_only_pickle_default = False
```

---

### ğŸ–¼ï¸ 3. `gui.py` - GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

**ç›®çš„**: ãƒ¡ã‚¤ãƒ³ã®ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `FirstRunSetupDialog`
åˆå›èµ·å‹•æ™‚ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ€ã‚¤ã‚¢ãƒ­ã‚°

**ãƒ¡ã‚½ãƒƒãƒ‰**:
- `__init__(parent)`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åˆæœŸåŒ–
- `_create_dialog()`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°UIä½œæˆ
- `_open_models_folder()`: modelsãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã
- `_complete_setup()`: ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å‡¦ç†
- `show()`: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º

##### `AutoMosaicGUI`
ãƒ¡ã‚¤ãƒ³GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

**åˆæœŸåŒ–**:
```python
def __init__(self):
    """Initialize GUI application"""
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:

###### ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- `_add_images()`: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
- `_add_folder()`: ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ç”»åƒè¿½åŠ 
- `_clear_images()`: ç”»åƒãƒªã‚¹ãƒˆã‚¯ãƒªã‚¢
- `_select_output_folder()`: å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€é¸æŠ

###### å‡¦ç†åˆ¶å¾¡
- `_start_processing()`: å‡¦ç†é–‹å§‹
- `_stop_processing()`: å‡¦ç†åœæ­¢
- `_process_images()`: ç”»åƒå‡¦ç†ãƒ¡ã‚¤ãƒ³
- `_process_single_image()`: å˜ä¸€ç”»åƒå‡¦ç†

###### ãƒ¢ãƒ‡ãƒ«ç®¡ç†
- `_initialize_models()`: ãƒ¢ãƒ‡ãƒ«åˆæœŸåŒ–
- `_setup_model_settings()`: ãƒ¢ãƒ‡ãƒ«è¨­å®šUI
- `_update_model_checkboxes_display()`: ãƒ¢ãƒ‡ãƒ«é¸æŠè¡¨ç¤ºæ›´æ–°

###### ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ç®¡ç†ï¼ˆæ–°æ©Ÿèƒ½ï¼‰
- `_add_custom_model()`: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¿½åŠ 
- `_edit_custom_model()`: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ç·¨é›†
- `_remove_custom_model()`: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«å‰Šé™¤
- `_batch_manage_custom_models()`: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ä¸€æ‹¬ç®¡ç†
- `_show_custom_model_dialog()`: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°

###### èªè¨¼ç®¡ç†ï¼ˆæ–°æ©Ÿèƒ½ï¼‰
- `_show_auth_method_selection()`: èªè¨¼æ–¹å¼é¸æŠ
- `_force_authentication()`: å¼·åˆ¶èªè¨¼
- `_clear_authentication()`: èªè¨¼ã‚¯ãƒªã‚¢

###### è¨­å®šUIæ§‹ç¯‰
- `_setup_basic_settings()`: åŸºæœ¬è¨­å®šUI
- `_setup_mosaic_settings()`: ãƒ¢ã‚¶ã‚¤ã‚¯è¨­å®šUI
- `_setup_detector_settings()`: æ¤œå‡ºå™¨è¨­å®šUI
- `_setup_custom_model_settings_content()`: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨­å®šUI
- `_setup_filename_settings_content()`: ãƒ•ã‚¡ã‚¤ãƒ«åè¨­å®šUI

**æ–°è¨­å®šé …ç›®**:
- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨ (ä»»æ„ã®.ptãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ)
- èªè¨¼æ–¹å¼é¸æŠ (é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰æ™‚)
- æ¤œå‡ºå™¨ãƒ¢ãƒ¼ãƒ‰ (anime_only/nudenet_only/hybrid)
- ãƒã‚¹ã‚¯æ–¹å¼é¸æŠ (contour/rectangle)
- å€‹åˆ¥æ‹¡å¼µè¨­å®š (éƒ¨ä½åˆ¥æ‹¡å¼µãƒ”ã‚¯ã‚»ãƒ«æ•°)

---

## ğŸ” èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 

### ğŸ” 4. `auth_manager.py` - çµ±åˆèªè¨¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

**ç›®çš„**: è¤‡æ•°ã®èªè¨¼æ–¹å¼ã‚’çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ç®¡ç†

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `AuthenticationManager`
çµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä¸­æ ¸

**åˆæœŸåŒ–**:
```python
def __init__(self):
    self.auth_config = AuthConfig()
    self.discord_auth = DiscordAuthAdapter()
    self.monthly_auth = MonthlyAuth()
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `authenticate(parent, force_dialog)`: çµ±åˆèªè¨¼å®Ÿè¡Œ
- `is_authenticated()`: ç¾åœ¨ã®èªè¨¼çŠ¶æ…‹ç¢ºèª
- `clear_authentication()`: èªè¨¼æƒ…å ±ã‚¯ãƒªã‚¢
- `get_current_auth_method()`: ç¾åœ¨ã®èªè¨¼æ–¹å¼å–å¾—
- `set_auth_method(method)`: èªè¨¼æ–¹å¼è¨­å®š

**èªè¨¼ãƒ•ãƒ­ãƒ¼**:
1. è¨­å®šæ¸ˆã¿èªè¨¼æ–¹å¼ã®ç¢ºèª
2. æ–¹å¼ã«å¿œã˜ãŸèªè¨¼å®Ÿè¡Œ
3. å¤±æ•—æ™‚ã®ä»£æ›¿æ–¹å¼è©¦è¡Œ
4. èªè¨¼çŠ¶æ…‹ã®æ°¸ç¶šåŒ–

##### `AuthMethodSelectionDialog`
èªè¨¼æ–¹å¼é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°

**å¯¾å¿œèªè¨¼æ–¹å¼**:
- `MONTHLY_PASSWORD`: æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
- `DISCORD`: Discord OAuth2èªè¨¼

---

### âš™ï¸ 5. `auth_config.py` - èªè¨¼è¨­å®šç®¡ç†ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

**ç›®çš„**: èªè¨¼æ–¹å¼ã®è¨­å®šä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ç®¡ç†

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `AuthMethod` (Enum)
```python
class AuthMethod(Enum):
    MONTHLY_PASSWORD = "monthly_password"
    DISCORD = "discord"
```

##### `AuthConfig`
èªè¨¼è¨­å®šã®ä¸€å…ƒç®¡ç†

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `is_developer_mode()`: é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š
- `is_auth_method_switching_available()`: èªè¨¼æ–¹å¼åˆ‡ã‚Šæ›¿ãˆå¯èƒ½åˆ¤å®š
- `get_auth_method()`: ç¾åœ¨ã®èªè¨¼æ–¹å¼å–å¾—
- `set_auth_method(method)`: èªè¨¼æ–¹å¼è¨­å®š
- `ensure_developer_mode_settings()`: é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰è¨­å®šè‡ªå‹•é©ç”¨

**é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š**:
```python
# .envãƒ•ã‚¡ã‚¤ãƒ«ã®DEVELOPER_MODEè¨­å®šã‚’ä½¿ç”¨
DEVELOPER_MODE=true  # é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹
```

---

### ğŸ® 6. `discord_auth_adapter.py` - Discordèªè¨¼ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

**ç›®çš„**: Discord OAuth2èªè¨¼ã®å®Ÿè£…

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `DiscordTokenManager`
Discordãƒˆãƒ¼ã‚¯ãƒ³ã®ç®¡ç†

**æ©Ÿèƒ½**:
- ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿
- 7æ—¥é–“ã®æœ‰åŠ¹æœŸé™ç®¡ç†
- ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°

##### `DiscordAuthAdapter`
Discordèªè¨¼ã®å®Ÿè¡Œ

**OAuth2è¨­å®š**:
```python
self.DISCORD_CLIENT_ID = "your_client_id"
self.DISCORD_CLIENT_SECRET = "your_client_secret"
self.DISCORD_REDIRECT_URI = "http://localhost:8000/callback"
self.DISCORD_SCOPES = ["identify", "guilds", "guilds.members.read"]
```

**è¤‡æ•°ã‚µãƒ¼ãƒãƒ¼å¯¾å¿œ**:
```python
self.GUILD_CONFIGS = [
    {
        "guild_id": "server_id_1",
        "name": "æ‰¿èªæ¸ˆã¿ã‚µãƒ¼ãƒãƒ¼1",
        "required_roles": ["premium_member", "vip"]
    },
    # è¤‡æ•°ã‚µãƒ¼ãƒãƒ¼è¨­å®šå¯èƒ½
]
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `authenticate()`: Discordèªè¨¼å®Ÿè¡Œ
- `is_authenticated()`: èªè¨¼çŠ¶æ…‹ç¢ºèª
- `clear_authentication()`: èªè¨¼ã‚¯ãƒªã‚¢
- `_check_user_roles()`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ç¢ºèª

---

### ğŸ”§ 7. `env_config.py` - ç’°å¢ƒå¤‰æ•°è¨­å®šç®¡ç†ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

**ç›®çš„**: .envãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®è¨­å®šèª­ã¿è¾¼ã¿ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `EnvironmentConfig`
ç’°å¢ƒå¤‰æ•°è¨­å®šç®¡ç†

**å¯¾å¿œè¨­å®š**:
```env
# .env ãƒ•ã‚¡ã‚¤ãƒ«ä¾‹
DEVELOPER_MODE=true
MONTHLY_PASSWORD_2025_01=hashed_password_value
MASTER_PASSWORD=hashed_master_password
DISCORD_CLIENT_ID=your_discord_client_id
DISCORD_CLIENT_SECRET=your_discord_client_secret
```

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `is_developer_mode()`: é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š
- `get_monthly_passwords()`: æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§å–å¾—
- `get_master_password_hash()`: ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥å–å¾—
- `validate_env_file()`: .envãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼

---

### ğŸ”’ 8. `encrypted_config.py` - æš—å·åŒ–è¨­å®šç®¡ç†ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

**ç›®çš„**: é…å¸ƒç‰ˆã§ã®èªè¨¼æƒ…å ±å®‰å…¨ç®¡ç†

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `EncryptedConfigManager`
æš—å·åŒ–ã•ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†

**æš—å·åŒ–ä»•æ§˜**:
- AESæš—å·åŒ–ï¼ˆFernetï¼‰
- PBKDF2ã«ã‚ˆã‚‹ã‚­ãƒ¼å°å‡º
- ã‚½ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åˆ†é›¢ç®¡ç†

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«é…ç½®**:
```
%APPDATA%\è‡ªå‹•ãƒ¢ã‚¶ã‚¨ã‚»\config\
â”œâ”€â”€ auth.dat          # æš—å·åŒ–è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ auth.salt         # ã‚½ãƒ«ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
```

##### `DistributionConfigLoader`
é…å¸ƒç‰ˆè¨­å®šãƒ­ãƒ¼ãƒ€ãƒ¼

**å¯¾å¿œè¨­å®š**:
- æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸€è¦§
- Discord OAuth2è¨­å®š
- é…å¸ƒç‰ˆå›ºæœ‰è¨­å®š

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `load_discord_config()`: Discordè¨­å®šèª­ã¿è¾¼ã¿
- `create_encrypted_config()`: æš—å·åŒ–è¨­å®šä½œæˆ
- `decrypt_config()`: è¨­å®šå¾©å·åŒ–

---

### âš¡ 9. `lazy_loader.py` - é…å»¶ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

**ç›®çš„**: é‡ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é…å»¶ãƒ­ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `LazyLoader`
é…å»¶ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

**å¯¾è±¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**:
- PyTorch (torch)
- Ultralytics YOLO
- Segment Anything Model
- NudeNet
- OpenCVé‡ã„æ©Ÿèƒ½

**æœ€é©åŒ–æ©Ÿèƒ½**:
- DLLãƒ‘ã‚¹è‡ªå‹•è¨­å®š
- CUDAç’°å¢ƒå¤‰æ•°ç®¡ç†
- ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªé…å»¶ãƒ­ãƒ¼ãƒ‰
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰**:
- `load_module(name)`: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é…å»¶ãƒ­ãƒ¼ãƒ‰
- `_setup_dll_path()`: DLLãƒ‘ã‚¹è¨­å®š
- `_get_cuda_dll_path()`: CUDA DLLãƒ‘ã‚¹å–å¾—

**CUDAæœ€é©åŒ–**:
```python
# exeåŒ–æ™‚ã®CUDA DLLé…ç½®
exe_dir/
â”œâ”€â”€ cuda_libs/          # CUDAå°‚ç”¨DLL
â”œâ”€â”€ external_libs/      # ä¸€èˆ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â””â”€â”€ è‡ªå‹•ãƒ¢ã‚¶ã‚¨ã‚».exe
```

---

### çµ±åˆèªè¨¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
# èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®éšå±¤æ§‹é€ 
AuthenticationManager (auth_manager.py)
â”œâ”€â”€ AuthConfig (auth_config.py)           # è¨­å®šãƒ»åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ DiscordAuthAdapter (discord_auth_adapter.py)  # Discord OAuth2
â”œâ”€â”€ MonthlyAuth (auth.py)                 # æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
â””â”€â”€ EncryptedConfigManager (encrypted_config.py)  # æš—å·åŒ–è¨­å®š
```

### ğŸ” æš—å·åŒ–è¨­å®šã‚·ã‚¹ãƒ†ãƒ 

#### æŠ€è¡“ä»•æ§˜

**æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **:
- **æš—å·æ–¹å¼**: Fernet (AES 128 in CBC mode + HMAC authentication)
- **ã‚­ãƒ¼å°å‡º**: PBKDF2-HMAC-SHA256 (100,000 iterations)
- **ã‚½ãƒ«ãƒˆ**: 16ãƒã‚¤ãƒˆãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
- **ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼**: `AUTO_MOSAIC_DIST_2025` (ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰åŸ‹ã‚è¾¼ã¿)

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**:
```
config/
â”œâ”€â”€ auth.dat      # æš—å·åŒ–ã•ã‚ŒãŸDiscordèªè¨¼ãƒ‡ãƒ¼ã‚¿ (JSON)
â””â”€â”€ auth.salt     # PBKDF2ç”¨ã‚½ãƒ«ãƒˆ (16 bytes)
```

#### æš—å·åŒ–ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```python
# auth.dat å†…éƒ¨æ§‹é€  (å¾©å·åŒ–å¾Œã®JSON)
{
    "client_id": "YOUR_DISCORD_CLIENT_ID",
    "client_secret": "YOUR_DISCORD_CLIENT_SECRET",
    "guilds": [
        {
            "guild_id": "GUILD_ID_1",
            "name": "ã‚µãƒ¼ãƒãƒ¼å1",
            "required_roles": ["ROLE_ID_1", "ROLE_ID_2"]
        },
        {
            "guild_id": "GUILD_ID_2",
            "name": "ã‚µãƒ¼ãƒãƒ¼å2", 
            "required_roles": ["ROLE_ID_3"]
        }
    ],
    "redirect_uri": "http://localhost:8000/callback",
    "scopes": ["identify", "guilds", "guilds.members.read"],
    "max_failures": 3,
    "cooldown": 10
}
```

#### é…å¸ƒç”¨è¨­å®šä½œæˆæ‰‹é †

**1. é–‹ç™ºç’°å¢ƒã§ã®è¨­å®šä½œæˆ**:
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã«Discordèªè¨¼æƒ…å ±ã‚’è¨­å®š
DEVELOPER_MODE=true
DISCORD_CLIENT_ID=YOUR_DISCORD_CLIENT_ID
DISCORD_CLIENT_SECRET=YOUR_DISCORD_CLIENT_SECRET
# ... ãã®ä»–ã®è¨­å®š

# æš—å·åŒ–ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
python create_distribution_config.py
```

**2. è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†**:
```python
# encrypted_config.py ã§ã®è‡ªå‹•å‡¦ç†
def create_distribution_config(discord_config):
    """é…å¸ƒç”¨æš—å·åŒ–è¨­å®šä½œæˆ"""
    # 1. ã‚½ãƒ«ãƒˆç”Ÿæˆ (auth.salt)
    salt = os.urandom(16)
    
    # 2. ã‚­ãƒ¼å°å‡º
    key = PBKDF2HMAC(SHA256, 32, salt, 100000).derive(master_key)
    
    # 3. æš—å·åŒ– (auth.dat)
    fernet = Fernet(base64.urlsafe_b64encode(key))
    encrypted_data = fernet.encrypt(json.dumps(discord_config).encode())
    
    # 4. ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    self.encrypted_config_file.write_bytes(encrypted_data)
    self.salt_file.write_bytes(salt)
```

#### é…å¸ƒç‰ˆã§ã®è‡ªå‹•èª­ã¿è¾¼ã¿

**å®Ÿè¡Œæ™‚ãƒ‘ã‚¹è§£æ±º**:
```python
# PyInstallerç’°å¢ƒæ¤œå‡ºã¨é©åˆ‡ãªãƒ‘ã‚¹è¨­å®š
if getattr(sys, 'frozen', False):
    # exeå®Ÿè¡Œæ™‚: å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    self.app_data_dir = Path(sys.executable).parent
else:
    # é–‹ç™ºç’°å¢ƒ: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ
    self.app_data_dir = Path(__file__).parent.parent.parent
```

**å¾©å·åŒ–ãƒ•ãƒ­ãƒ¼**:
```python
def decrypt_config(self):
    """æš—å·åŒ–è¨­å®šã®è‡ªå‹•å¾©å·åŒ–"""
    # 1. ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
    if not (auth.dat exists and auth.salt exists):
        return None
    
    # 2. ã‚½ãƒ«ãƒˆèª­ã¿è¾¼ã¿
    salt = self.salt_file.read_bytes()
    
    # 3. ã‚­ãƒ¼å†å°å‡º
    key = PBKDF2HMAC(...).derive(self.master_key)
    
    # 4. å¾©å·åŒ–
    fernet = Fernet(key)
    decrypted_data = fernet.decrypt(encrypted_data)
    
    # 5. JSONè§£æ
    return json.loads(decrypted_data.decode())
```

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

**âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–è¦ç´ **:
- PBKDF2ã«ã‚ˆã‚‹è¨ˆç®—é‡ã®ç¢ºä¿ (100,000 iterations)
- Fernetã«ã‚ˆã‚‹èªè¨¼ä»˜ãæš—å·åŒ– (æ”¹ã–ã‚“æ¤œå‡º)
- ãƒ©ãƒ³ãƒ€ãƒ ã‚½ãƒ«ãƒˆã«ã‚ˆã‚‹ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«æ”»æ’ƒé˜²æ­¢
- ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰åŸ‹ã‚è¾¼ã¿ (ãƒã‚¤ãƒŠãƒªè§£æã«ã‚ˆã‚‹ä¿è­·)

**âš ï¸ é…å¸ƒæ™‚æ³¨æ„äº‹é …**:
- `auth.dat` + `auth.salt` ã®**ä¸¡æ–¹**ãŒå¿…é ˆ
- ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼å¤‰æ›´æ™‚ã¯å…¨é…å¸ƒç‰ˆã®å†ç”ŸæˆãŒå¿…è¦
- æš—å·åŒ–ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯å®Ÿéš›ã®èªè¨¼æƒ…å ±ãŒå«ã¾ã‚Œã‚‹
- AGPLãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«å¾“ã£ãŸé©åˆ‡ãªé…å¸ƒç®¡ç†

**ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**:
```python
# æš—å·åŒ–ã‚¨ãƒ©ãƒ¼ã®ä¸»ãªåŸå› ã¨å¯¾å‡¦
try:
    config = encrypted_manager.decrypt_config()
except Exception as e:
    if "cryptography" in str(e):
        # PyInstallerãƒ“ãƒ«ãƒ‰ã§ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¶³
        # â†’ hiddenimports ã« cryptography è¿½åŠ 
    elif "Fernet" in str(e):
        # ã‚­ãƒ¼ã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ç ´æ
        # â†’ ãƒ•ã‚¡ã‚¤ãƒ«å†ç”ŸæˆãŒå¿…è¦
    elif "FileNotFoundError" in str(e):
        # ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ãƒŸã‚¹
        # â†’ config/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç¢ºèª
```

---

### èªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•] --> B[AuthenticationManageråˆæœŸåŒ–]
    B --> C[é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š]
    C --> D{é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ï¼Ÿ}
    
    D -->|Yes| E[èªè¨¼æ–¹å¼é¸æŠUIè¡¨ç¤º]
    D -->|No| F[Discordèªè¨¼ã®ã¿å®Ÿè¡Œ]
    
    E --> G{é¸æŠã•ã‚ŒãŸèªè¨¼æ–¹å¼}
    G -->|Discord| H[Discord OAuth2èªè¨¼]
    G -->|æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰| I[æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼]
    
    H --> J{èªè¨¼æˆåŠŸï¼Ÿ}
    I --> J
    F --> J
    
    J -->|Yes| K[ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹]
    J -->|No| L{é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ï¼Ÿ}
    
    L -->|Yes| M[ä»£æ›¿èªè¨¼ææ¡ˆ]
    L -->|No| N[ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†]
    
    M --> E
```

### é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¶å¾¡

```python
# auth_config.py - é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šã®5ã¤ã®åŸºæº–
def is_developer_mode() -> bool:
    criteria = [
        _check_env_variable(),      # ç’°å¢ƒå¤‰æ•° AUTO_MOSAIC_DEV_MODE
        _check_developer_file(),    # .developer_mode ãƒ•ã‚¡ã‚¤ãƒ«
        _check_config_setting(),    # auth_config.json è¨­å®š
        _check_dev_environment(),   # é–‹ç™ºç’°å¢ƒæ¤œå‡º
        _check_executable_context() # å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«åˆ¤å®š
    ]
    return any(criteria)  # ã„ãšã‚Œã‹ãŒçœŸã®å ´åˆã€é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰
```

---

## ğŸ§  AIãƒ»ç”»åƒå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ 

### ğŸ¯ 10. `detector.py` - YOLOæ¤œå‡ºã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆæ›´æ–°ï¼‰

**ç›®çš„**: YOLO-basedã®å±€éƒ¨æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ 

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `MultiModelDetector`ï¼ˆæ›´æ–°ï¼‰
è¤‡æ•°å°‚ç”¨ãƒ¢ãƒ‡ãƒ« + ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«æ¤œå‡ºå™¨

**ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«å¯¾å¿œ**:
```python
def _load_custom_models(self):
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚€"""
    for model_name, model_config in self.config.custom_models.items():
        if model_config.get('enabled', False):
            model_path = Path(model_config.get('path', ''))
            # ã‚«ã‚¹ã‚¿ãƒ YOLOãƒ¢ãƒ‡ãƒ«ã‚’å‹•çš„ãƒ­ãƒ¼ãƒ‰
```

**ã‚¯ãƒ©ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°**:
```python
# ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ã®ã‚¯ãƒ©ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°ä¾‹
custom_class_mappings = {
    "custom_anime_model": {
        0: "penis",
        1: "vagina", 
        2: "anus",
        3: "nipples"
    }
}
```

**æ¤œå‡ºãƒ¢ãƒ¼ãƒ‰**:
- `anime_only`: ã‚¤ãƒ©ã‚¹ãƒˆå°‚ç”¨ãƒ¢ãƒ‡ãƒ«ã®ã¿
- `nudenet_only`: NudeNetï¼ˆå®Ÿå†™ï¼‰ã®ã¿  
- `hybrid`: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œå‡ºï¼ˆæ¨å¥¨ï¼‰
- `custom`: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨

**æŸ”è»Ÿãªãƒ¢ãƒ‡ãƒ«æ¤œç´¢**:
```python
def find_model_files_in_search_paths(self, model_name: str):
    """è¤‡æ•°å ´æ‰€ã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢"""
    search_dirs = [
        self.models_dir,                    # æ¨™æº–modelsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        exe_dir,                           # exeå®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        project_root,                      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ
        exe_dir / "models",                # exe/models
        project_root / "anime_nsfw_v4"     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/anime_nsfw_v4
    ]
```

---

### ğŸ“¥ 11. `downloader.py` - ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼ˆæ›´æ–°ï¼‰

**ç›®çš„**: MLãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

**CivitAI APIé€£æº**:
```python
def set_civitai_api_key(self, api_key: str):
    """CivitAI APIã‚­ãƒ¼ã‚’è¨­å®š"""
    self.civitai_api_key = api_key
```

**ã‚¹ãƒãƒ¼ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**:
```python
def smart_model_setup(self, progress_callback):
    """è‡ªå‹•ãƒ»æ‰‹å‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®çµ„ã¿åˆã‚ã›"""
    # è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ â†’ è‡ªå‹•å®Ÿè¡Œ
    # æ‰‹å‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¿…è¦ â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
```

**é…å¸ƒç‰ˆå¯¾å¿œ**:
- exeå†…åŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«æ¤œå‡º
- å¤–éƒ¨é…ç½®ãƒ¢ãƒ‡ãƒ«å„ªå…ˆèª­ã¿è¾¼ã¿
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œç´¢æ©Ÿèƒ½

---

### ğŸ”§ 12. `utils.py` - ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆæ›´æ–°ï¼‰

#### ä¸»è¦ã‚¯ãƒ©ã‚¹

##### `ProcessingConfig`ï¼ˆæ›´æ–°ï¼‰
å‡¦ç†è¨­å®šã®ä¸€å…ƒç®¡ç†

**æ–°è¨­å®šé …ç›®**:
```python
# ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨­å®š
self.use_custom_models = False
self.custom_models = {}  # {"name": {"path": "", "enabled": True, "class_mapping": {}}}

# æ¤œå‡ºå™¨é¸æŠè¨­å®š  
self.detector_mode = "hybrid"        # anime_only/nudenet_only/hybrid
self.use_anime_detector = True
self.use_nudenet = True

# ãƒã‚¹ã‚¯æ–¹å¼é¸æŠ
self.sam_use_vit_b = True           # è¼ªéƒ­ãƒã‚¹ã‚¯ï¼ˆé«˜ç²¾åº¦ï¼‰
self.sam_use_none = False           # çŸ©å½¢ãƒã‚¹ã‚¯ï¼ˆé«˜é€Ÿï¼‰

# å€‹åˆ¥æ‹¡å¼µè¨­å®š
self.use_individual_expansion = False
self.individual_expansions = {
    "penis": 15,
    "labia_minora": 15,
    "testicles": 15,
    # éƒ¨ä½åˆ¥ã«å€‹åˆ¥è¨­å®šå¯èƒ½
}
```

**é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š**:
```python
def is_developer_mode() -> bool:
    """é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼ˆçµ±ä¸€åŒ–ï¼‰"""
    try:
        from auto_mosaic.src.env_config import get_env_config
        env_config = get_env_config()
        return env_config.is_developer_mode()
    except Exception:
        return False
```

---

### ãƒãƒ«ãƒãƒ¢ãƒ‡ãƒ«æ¤œå‡ºã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
# detector.py - ãƒãƒ«ãƒãƒ¢ãƒ‡ãƒ«æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ 
class MultiModelDetector:
    """è¤‡æ•°ã®ç‰¹åŒ–å‹ãƒ¢ãƒ‡ãƒ«ã‚’çµ±åˆã—ãŸæ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self, config, device="auto"):
        self.models = {}                    # ãƒ¢ãƒ‡ãƒ«è¾æ›¸
        self.nudenet_detector = None        # NudeNetæ¤œå‡ºå™¨
        self.hybrid_detector = None         # ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œå‡ºå™¨
        
    def load_selected_models(self):
        """é¸æŠã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã‚’å‹•çš„èª­ã¿è¾¼ã¿"""
        for model_name, enabled in self.config.selected_models.items():
            if enabled:
                self.models[model_name] = self._load_model(model_name)
    
    def detect(self, image):
        """çµ±åˆæ¤œå‡ºå‡¦ç†"""
        detections = []
        
        # Anime NSFW Detection v4.0ã«ã‚ˆã‚‹æ¤œå‡º
        for model_name, model in self.models.items():
            detections.extend(self._run_model_detection(model, image))
        
        # NudeNet ã«ã‚ˆã‚‹è£œå®Œæ¤œå‡º
        if self.nudenet_detector:
            detections.extend(self.nudenet_detector.detect(image))
        
        # ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å‡¦ç†
        if self.hybrid_detector:
            detections = self.hybrid_detector.merge_detections(detections)
        
        return detections
```

### ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

```python
# segmenter.py - SAMã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
class GenitalSegmenter:
    """SAM (Segment Anything Model) ã‚’ä½¿ç”¨ã—ãŸé«˜ç²¾åº¦ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³"""
    
    def __init__(self, model_type="vit_b", device="auto"):
        self.model_type = model_type
        self.device = device
        self.sam_model = None
        self.predictor = None
        
    def segment_from_bbox(self, image, bbox):
        """ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚¹ã‚¯ã‚’ç”Ÿæˆ"""
        # SAMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã—ã¦ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨
        self.predictor.set_image(image)
        
        # ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã—ã¦è¨­å®š
        input_box = np.array([bbox[0], bbox[1], bbox[2], bbox[3]])
        
        # ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
        masks, scores, logits = self.predictor.predict(
            box=input_box[None, :],
            multimask_output=False
        )
        
        return masks[0]  # æœ€é«˜ã‚¹ã‚³ã‚¢ã®ãƒã‚¹ã‚¯ã‚’è¿”ã™
```

### ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³

```python
# mosaic.py - ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ 
class MosaicProcessor:
    """é«˜å“è³ªãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³"""
    
    def apply_mosaic(self, image, mask, config):
        """è¨­å®šã«åŸºã¥ããƒ¢ã‚¶ã‚¤ã‚¯é©ç”¨"""
        processed_images = []
        
        for mosaic_type, enabled in config.mosaic_types.items():
            if enabled:
                if mosaic_type == "block":
                    result = self._apply_block_mosaic(image, mask, config)
                elif mosaic_type == "gaussian":
                    result = self._apply_gaussian_mosaic(image, mask, config)
                elif mosaic_type == "white":
                    result = self._apply_white_mosaic(image, mask, config)
                elif mosaic_type == "black":
                    result = self._apply_black_mosaic(image, mask, config)
                
                processed_images.append((mosaic_type, result))
        
        return processed_images
    
    def _apply_block_mosaic(self, image, mask, config):
        """ãƒ–ãƒ­ãƒƒã‚¯ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†"""
        tile_size = calculate_tile_size(image.shape, config)
        
        # FANZAæº–æ‹ ã®ã‚¿ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¨ˆç®—
        if config.use_fanza_standard:
            tile_size = max(16, min(64, tile_size))
        
        # ãƒ¢ã‚¶ã‚¤ã‚¯é©ç”¨
        mosaic_image = image.copy()
        mask_coords = np.where(mask > 0)
        
        for y, x in zip(mask_coords[0], mask_coords[1]):
            # ã‚¿ã‚¤ãƒ«é ˜åŸŸã®è¨ˆç®—
            y_start = (y // tile_size) * tile_size
            y_end = y_start + tile_size
            x_start = (x // tile_size) * tile_size
            x_end = x_start + tile_size
            
            # ã‚¿ã‚¤ãƒ«å†…ã®å¹³å‡è‰²ã§ç½®æ›
            tile_region = image[y_start:y_end, x_start:x_end]
            avg_color = np.mean(tile_region, axis=(0, 1))
            mosaic_image[y_start:y_end, x_start:x_end] = avg_color
        
        return mosaic_image
```

---

## ğŸ–¥ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ 

### GUI ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
# gui.py - ãƒ¡ã‚¤ãƒ³GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
class AutoMosaicGUI:
    """ãƒ¡ã‚¤ãƒ³GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - MVC ãƒ‘ã‚¿ãƒ¼ãƒ³"""
    
    def __init__(self):
        # Model: ãƒ‡ãƒ¼ã‚¿ãƒ»è¨­å®š
        self.config = ProcessingConfig()
        self.image_paths = []
        self.processing = False
        
        # View: GUI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        self._setup_gui()
        
        # Controller: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        self._setup_event_handlers()
    
    def _setup_gui(self):
        """GUI ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹ç¯‰"""
        # ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ³ãƒã‚¹
        canvas = tk.Canvas(self.root)
        scrollbar = ttk.Scrollbar(self.root, orient="vertical", command=canvas.yview)
        scrollable_frame = ttk.Frame(canvas)
        
        # 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
        left_column = ttk.Frame(main_frame)    # ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ»å‡¦ç†åˆ¶å¾¡
        right_column = ttk.Frame(main_frame)   # è¨­å®šé …ç›®
        
        # è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹ç¯‰
        self._setup_basic_settings(right_column, row=0)
        self._setup_mosaic_settings(right_column, row=1)
        self._setup_model_settings(right_column, row=2)
        self._setup_advanced_options(right_column, row=3)  # ğŸ”§ é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³
```

### é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­è¨ˆ

```python
# é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ - æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½UI
class ExpandableFrame(ttk.Frame):
    """æŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ãªãƒ•ãƒ¬ãƒ¼ãƒ """
    
    def __init__(self, parent, text="", **kwargs):
        super().__init__(parent, **kwargs)
        
        # ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿ï¼‰
        self.toggle_button = ttk.Button(self, text=f"â–¶ {text}", 
                                       command=self.toggle)
        self.toggle_button.grid(row=0, column=0, sticky="ew")
        
        # ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆå±•é–‹æ™‚ã«è¡¨ç¤ºï¼‰
        self.content_frame = ttk.Frame(self)
        self.expanded = False
    
    def toggle(self):
        """å±•é–‹/æŠ˜ã‚ŠãŸãŸã¿åˆ‡ã‚Šæ›¿ãˆ"""
        if self.expanded:
            self.content_frame.grid_remove()
            self.toggle_button.config(text=f"â–¶ {self.text}")
            self.expanded = False
        else:
            self.content_frame.grid(row=1, column=0, sticky="ew", pady=(5, 0))
            self.toggle_button.config(text=f"â–¼ {self.text}")
            self.expanded = True

# é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³å†…å®¹ã®å‹•çš„æ§‹ç¯‰
def _setup_advanced_options(self, parent, row):
    """ğŸ”§ é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š"""
    advanced_frame = ExpandableFrame(parent, "ğŸ”§ é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³")
    advanced_frame.grid(row=row, column=0, sticky=(tk.W, tk.E), pady=(10, 0))
    
    # ãƒã‚¹ã‚¯æ–¹å¼é¸æŠ
    self._setup_mask_settings_content(advanced_frame.content_frame, row=0)
    
    # ãƒ•ã‚¡ã‚¤ãƒ«åè¨­å®š
    self._setup_filename_settings_content(advanced_frame.content_frame, row=1)
    
    # ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨­å®š
    self._setup_custom_model_settings_content(advanced_frame.content_frame, row=2)
    
    # æ¤œå‡ºå™¨è©³ç´°è¨­å®š
    self._setup_detector_settings(advanced_frame.content_frame, row=3)
    
    # å‡ºåŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    self._setup_output_options(advanced_frame.content_frame, row=4)
```

---

## ğŸ“¦ ã‚µãƒãƒ¼ãƒˆãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 

### ãƒ¢ãƒ‡ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼

```python
# downloader.py - ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ç®¡ç†
class ModelDownloader:
    """AIãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self):
        self.model_configs = {
            "anime_nsfw_v4": {
                "url": "https://civitai.com/api/download/models/1863248",
                "filename": "animeNSFWDetection_v40.zip",
                "extract_to": "models/anime_nsfw_v4/",
                "auth_required": True
            },
            "sam_vit_b": {
                "url": "https://dl.fbaipublicfiles.com/segment_anything/sam_vit_b_01ec64.pth",
                "filename": "sam_vit_b_01ec64.pth",
                "destination": "models/",
                "auth_required": False
            }
        }
    
    def smart_model_setup(self, progress_callback=None):
        """ã‚¹ãƒãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"""
        results = {"downloaded": [], "errors": [], "skipped": []}
        
        for model_name, config in self.model_configs.items():
            try:
                if self.is_model_available(model_name):
                    results["skipped"].append(model_name)
                    continue
                
                success = self.download_model(model_name, progress_callback)
                if success:
                    results["downloaded"].append(model_name)
                else:
                    results["errors"].append(f"{model_name}: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¤±æ•—")
                    
            except Exception as e:
                results["errors"].append(f"{model_name}: {str(e)}")
        
        return results
```

### å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```python
# utils.py - å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
class ProcessingConfig:
    """å‡¦ç†è¨­å®šã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        # ãƒ¢ã‚¶ã‚¤ã‚¯è¨­å®š
        self.strength = 1.0              # ãƒ¢ã‚¶ã‚¤ã‚¯å¼·åº¦
        self.feather = 5                 # ã‚¨ãƒƒã‚¸ãƒ•ã‚§ã‚¶ãƒªãƒ³ã‚°
        self.confidence = 0.25           # æ¤œå‡ºä¿¡é ¼åº¦é–¾å€¤
        
        # æ¤œå‡ºç¯„å›²èª¿æ•´
        self.bbox_expansion = 15         # ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹æ‹¡å¼µ
        
        # ãƒ¢ã‚¶ã‚¤ã‚¯åŠ¹æœè¨­å®š
        self.mosaic_types = {
            "block": True,               # ãƒ–ãƒ­ãƒƒã‚¯ãƒ¢ã‚¶ã‚¤ã‚¯
            "gaussian": False,           # ã‚¬ã‚¦ã‚¹ãƒ¢ã‚¶ã‚¤ã‚¯
            "white": False,              # ç™½å¡—ã‚Š
            "black": False               # é»’å¡—ã‚Š
        }
        
        # ãƒ‡ãƒã‚¤ã‚¹è¨­å®š
        self.device_mode = "auto"        # GPU/CPUè‡ªå‹•é¸æŠ
        
        # é¸æŠãƒ¢ãƒ‡ãƒ«è¨­å®š
        self.selected_models = {
            "penis": True,
            "labia_minora": True,        # å°é™°å”‡
            "labia_majora": True,        # å¤§é™°å”‡
            "testicles": True,
            "anus": True,
            "nipples": False,
            "x-ray": False,
            "cross-section": False
        }

# é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãƒ»é…å¸ƒãƒ¢ãƒ¼ãƒ‰åˆ¤å®š
def is_developer_mode() -> bool:
    """é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼ˆçµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ é€£æºï¼‰"""
    try:
        from auto_mosaic.src.auth_config import AuthConfig
        return AuthConfig().is_developer_mode()
    except:
        return False

def is_distribution_mode() -> bool:
    """é…å¸ƒãƒ¢ãƒ¼ãƒ‰åˆ¤å®šï¼ˆé–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã®é€†ï¼‰"""
    return not is_developer_mode()
```

---

## ğŸ”„ å‡¦ç†ãƒ•ãƒ­ãƒ¼

### çµ±åˆèªè¨¼ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[ã‚¢ãƒ—ãƒªèµ·å‹•] --> B[AuthenticationManageråˆæœŸåŒ–]
    B --> C[AuthConfigèª­ã¿è¾¼ã¿]
    C --> D{é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰?}
    D -->|Yes| E[æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼å„ªå…ˆ]
    D -->|No| F[è¨­å®šæ¸ˆã¿èªè¨¼æ–¹å¼]
    E --> G[èªè¨¼å®Ÿè¡Œ]
    F --> G
    G --> H{èªè¨¼æˆåŠŸ?}
    H -->|No| I[ä»£æ›¿æ–¹å¼è©¦è¡Œ]
    H -->|Yes| J[èªè¨¼çŠ¶æ…‹ä¿å­˜]
    I --> G
    J --> K[ãƒ¡ã‚¤ãƒ³GUIè¡¨ç¤º]
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«æœ‰åŠ¹?] --> B{æœ‰åŠ¹}
    B -->|Yes| C[.ptãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿]
    C --> D[ã‚¯ãƒ©ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°é©ç”¨]
    D --> E[æ¨™æº–ãƒ¢ãƒ‡ãƒ«ã¨çµ±åˆ]
    E --> F[çµ±åˆæ¤œå‡ºå®Ÿè¡Œ]
    B -->|No| G[æ¨™æº–ãƒ¢ãƒ‡ãƒ«ã®ã¿]
    G --> H[æ¨™æº–æ¤œå‡ºå®Ÿè¡Œ]
    F --> I[çµæœçµ±åˆ]
    H --> I
```

### é…å»¶ãƒ­ãƒ¼ãƒ€ãƒ¼ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[é‡ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¦æ±‚] --> B{æ—¢ã«ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿?}
    B -->|Yes| C[ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¿”å´]
    B -->|No| D[DLLãƒ‘ã‚¹è¨­å®š]
    D --> E[å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ]
    E --> F[ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜]
    F --> G[ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¿”å´]
    C --> H[å‡¦ç†ç¶šè¡Œ]
    G --> H
```

---

## ğŸ¯ APIä½¿ç”¨ä¾‹

### çµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä½¿ç”¨ä¾‹

```python
from auto_mosaic.src.auth_manager import AuthenticationManager, AuthMethod

# èªè¨¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼åˆæœŸåŒ–
auth_manager = AuthenticationManager()

# èªè¨¼å®Ÿè¡Œ
if auth_manager.authenticate():
    print("èªè¨¼æˆåŠŸ")
    
    # ç¾åœ¨ã®èªè¨¼æ–¹å¼ç¢ºèª
    current_method = auth_manager.get_current_auth_method()
    print(f"èªè¨¼æ–¹å¼: {current_method.value}")
else:
    print("èªè¨¼å¤±æ•—")

# èªè¨¼æ–¹å¼åˆ‡ã‚Šæ›¿ãˆï¼ˆé–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ï¼‰
auth_manager.set_auth_method(AuthMethod.DISCORD)
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ã®ä½¿ç”¨ä¾‹

```python
from auto_mosaic.src.utils import ProcessingConfig
from auto_mosaic.src.detector import MultiModelDetector

# ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨­å®š
config = ProcessingConfig()
config.use_custom_models = True
config.custom_models = {
    "my_anime_model": {
        "path": "/path/to/my_model.pt",
        "enabled": True,
        "class_mapping": {
            0: "penis",
            1: "vagina",
            2: "anus"
        }
    }
}

# æ¤œå‡ºå™¨åˆæœŸåŒ–ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«å«ã‚€ï¼‰
detector = MultiModelDetector(config=config)

# æ¤œå‡ºå®Ÿè¡Œ
bboxes_with_class = detector.detect(image, conf=0.25, config=config)

# çµæœã«ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ã®æ¤œå‡ºçµæœã‚‚å«ã¾ã‚Œã‚‹
for x1, y1, x2, y2, class_name, source in bboxes_with_class:
    print(f"æ¤œå‡º: {class_name} (ã‚½ãƒ¼ã‚¹: {source})")
    # source: 'IL'=ã‚¤ãƒ©ã‚¹ãƒˆå°‚ç”¨, 'PH'=NudeNet, 'CU'=ã‚«ã‚¹ã‚¿ãƒ 
```

### ç’°å¢ƒè¨­å®šç®¡ç†ã®ä½¿ç”¨ä¾‹

```python
from auto_mosaic.src.env_config import get_env_config

# ç’°å¢ƒè¨­å®šå–å¾—
env_config = get_env_config()

# é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š
if env_config.is_developer_mode():
    print("é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œä¸­")
    
    # æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å–å¾—
    monthly_passwords = env_config.get_monthly_passwords()
    print(f"è¨­å®šæ¸ˆã¿æœˆæ•°: {len(monthly_passwords)}")

# .envãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼
validation_results = env_config.validate_env_file()
for key, message in validation_results.items():
    print(f"{key}: {message}")
```

### é…å»¶ãƒ­ãƒ¼ãƒ€ãƒ¼ã®ä½¿ç”¨ä¾‹

```python
from auto_mosaic.src.lazy_loader import LazyLoader

# é…å»¶ãƒ­ãƒ¼ãƒ€ãƒ¼åˆæœŸåŒ–
loader = LazyLoader()

# é‡ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å¿…è¦æ™‚ã«ãƒ­ãƒ¼ãƒ‰
torch = loader.load_module('torch')
ultralytics = loader.load_module('ultralytics')

# åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã¿æ™‚é–“ãŒã‹ã‹ã‚Šã€2å›ç›®ä»¥é™ã¯é«˜é€Ÿ
yolo_model = ultralytics.YOLO('model.pt')
```

---

## ğŸ”§ è¨­å®šãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ProcessingConfigè¨­å®šé …ç›®ï¼ˆæ›´æ–°ï¼‰

| é …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|----|-----------|----|
| `use_custom_models` | bool | False | ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨ |
| `custom_models` | dict | {} | ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨­å®š |
| `detector_mode` | str | "hybrid" | æ¤œå‡ºå™¨ãƒ¢ãƒ¼ãƒ‰ |
| `use_anime_detector` | bool | True | ã‚¤ãƒ©ã‚¹ãƒˆå°‚ç”¨ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨ |
| `use_nudenet` | bool | True | å®Ÿå†™å°‚ç”¨ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨ |
| `sam_use_vit_b` | bool | True | SAM ViT-Bä½¿ç”¨ï¼ˆè¼ªéƒ­ï¼‰ |
| `sam_use_none` | bool | False | SAMãªã—ï¼ˆçŸ©å½¢ï¼‰ |
| `use_individual_expansion` | bool | False | å€‹åˆ¥æ‹¡å¼µä½¿ç”¨ |
| `individual_expansions` | dict | {...} | éƒ¨ä½åˆ¥æ‹¡å¼µè¨­å®š |

### èªè¨¼è¨­å®šé …ç›®ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

| é …ç›® | å‹ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|----|-----------|----|
| `auth_method` | str | "monthly_password" | èªè¨¼æ–¹å¼ |
| `allow_method_switching` | bool | True | æ–¹å¼åˆ‡ã‚Šæ›¿ãˆè¨±å¯ |
| `last_successful_method` | str | None | æœ€å¾Œã«æˆåŠŸã—ãŸæ–¹å¼ |

### ç’°å¢ƒå¤‰æ•°è¨­å®šé …ç›®ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

| ç’°å¢ƒå¤‰æ•° | å‹ | èª¬æ˜ | ä¾‹ |
|----------|----|----- |---|
| `DEVELOPER_MODE` | bool | é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ | true |
| `MONTHLY_PASSWORD_2025_01` | str | æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | ãƒãƒƒã‚·ãƒ¥å€¤ |
| `MASTER_PASSWORD` | str | ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | ãƒãƒƒã‚·ãƒ¥å€¤ |
| `DISCORD_CLIENT_ID` | str | Discordã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID | 123456789 |
| `DISCORD_CLIENT_SECRET` | str | Discordã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ | secret |

---

## ğŸš¨ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | å¯¾å‡¦æ³• |
|-------|------|--------|
| `Custom model file not found` | ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«æœªé…ç½® | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ç¢ºèªãƒ»å†è¨­å®š |
| `Discord authentication failed` | Discordèªè¨¼ã‚¨ãƒ©ãƒ¼ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®šç¢ºèª |
| `Developer mode required` | é–‹ç™ºè€…æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ | .envè¨­å®šç¢ºèª |
| `Encrypted config decryption failed` | æš—å·åŒ–è¨­å®šèª­ã¿è¾¼ã¿å¤±æ•— | auth.datãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª |
| `Lazy loading failed` | é…å»¶ãƒ­ãƒ¼ãƒ€ãƒ¼ã‚¨ãƒ©ãƒ¼ | DLLãƒ‘ã‚¹ãƒ»ä¾å­˜é–¢ä¿‚ç¢ºèª |

### ãƒ­ã‚°å‡ºåŠ›ä¾‹ï¼ˆæ›´æ–°ï¼‰

```
2025-01-XX XX:XX:XX - auto_mosaic - INFO - [AUTH] Integrated authentication started
2025-01-XX XX:XX:XX - auto_mosaic - INFO - [AUTH] Using monthly password method
2025-01-XX XX:XX:XX - auto_mosaic - INFO - [CUSTOM] Loading custom model 'my_anime_model'
2025-01-XX XX:XX:XX - auto_mosaic - INFO - [DETECTOR] Hybrid detection: anime=True, nudenet=True
2025-01-XX XX:XX:XX - auto_mosaic - INFO - [LAZY] Torch loaded with CUDA support
```

---

## ğŸ“ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

- **Version**: 1.0
- **Author**: Auto Mosaic Development Team  
- **License**: AGPL-3.0
- **Python**: 3.10+
- **Dependencies**: PyTorch, OpenCV, NumPy, tkinter, ultralytics, segment-anything, cryptography, python-dotenv

### äº’æ›æ€§æƒ…å ±
- v1.0è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚ã‚Š
- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«æ©Ÿèƒ½ã¯æ–°è¦è¿½åŠ 
- èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã¯çµ±åˆã•ã‚ŒãŸãŒå¾“æ¥æ–¹å¼ã‚‚åˆ©ç”¨å¯èƒ½

---

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- [Anime NSFW Detection v4.0](https://civitai.com/models/1313556?modelVersionId=1863248) - CivitAI
- [Segment Anything Model](https://github.com/facebookresearch/segment-anything) - Meta AI
- [YOLOv8](https://github.com/ultralytics/ultralytics) - Ultralytics
- [NudeNet](https://github.com/notAI-tech/NudeNet) - notAI-tech
- [Discord Developer Portal](https://discord.com/developers/applications) - OAuth2è¨­å®šç”¨

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°

### ç”»åƒå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
1. ç”»åƒå…¥åŠ›
   â”œâ”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ (GUI)
   â”œâ”€â”€ å½¢å¼æ¤œè¨¼ (utils.validate_image_path)
   â””â”€â”€ èª­ã¿è¾¼ã¿ (cv2.imread)

2. èªè¨¼ç¢ºèª
   â”œâ”€â”€ çµ±åˆèªè¨¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (auth_manager.py)
   â”œâ”€â”€ é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š (auth_config.py)
   â””â”€â”€ èªè¨¼æ–¹å¼é¸æŠ

3. AIæ¤œå‡ºå‡¦ç†
   â”œâ”€â”€ ãƒ¢ãƒ‡ãƒ«åˆæœŸåŒ– (detector.py)
   â”œâ”€â”€ NudeNetæ¤œå‡º (nudenet_detector.py)
   â”œâ”€â”€ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰åˆ¤å®š
   â””â”€â”€ æ¤œå‡ºçµæœçµ±åˆ

4. ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
   â”œâ”€â”€ SAMåˆæœŸåŒ– (segmenter.py)
   â”œâ”€â”€ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹â†’ãƒã‚¹ã‚¯å¤‰æ›
   â””â”€â”€ é«˜ç²¾åº¦è¼ªéƒ­æŠ½å‡º

5. ãƒ¢ã‚¶ã‚¤ã‚¯é©ç”¨
   â”œâ”€â”€ ãƒ¢ã‚¶ã‚¤ã‚¯ç¨®åˆ¥é¸æŠ (mosaic.py)
   â”œâ”€â”€ FANZAæº–æ‹ ã‚¿ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¨ˆç®—
   â””â”€â”€ è¤‡æ•°åŠ¹æœã®ä¸¦åˆ—å‡¦ç†

6. å‡ºåŠ›ä¿å­˜
   â”œâ”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«åãƒ¢ãƒ¼ãƒ‰é©ç”¨ (utils.py)
   â”œâ”€â”€ è¤‡æ•°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ
   â””â”€â”€ çµæœè¡¨ç¤º
```

### è¨­å®šç®¡ç†ãƒ•ãƒ­ãƒ¼

```
1. è¨­å®šèª­ã¿è¾¼ã¿
   â”œâ”€â”€ ProcessingConfigåˆæœŸåŒ–
   â”œâ”€â”€ æš—å·åŒ–è¨­å®šèª­ã¿è¾¼ã¿ (encrypted_config.py)
   â””â”€â”€ ç’°å¢ƒå¤‰æ•°é©ç”¨ (env_config.py)

2. GUIåæ˜ 
   â”œâ”€â”€ è¨­å®šå€¤â†’UIåŒæœŸ
   â”œâ”€â”€ åˆ¶ç´„æ¤œè¨¼
   â””â”€â”€ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤é©ç”¨

3. å‹•çš„æ›´æ–°
   â”œâ”€â”€ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨­å®šå¤‰æ›´
   â”œâ”€â”€ å³åº§ã®UIåæ˜ 
   â””â”€â”€ è¨­å®šä¿å­˜

4. æ°¸ç¶šåŒ–
   â”œâ”€â”€ JSONå½¢å¼ä¿å­˜
   â”œâ”€â”€ æš—å·åŒ–å‡¦ç†
   â””â”€â”€ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç®¡ç†
```

---

## ğŸ”§ æ‹¡å¼µæ€§è¨­è¨ˆ

### æ–°ã—ã„èªè¨¼æ–¹å¼ã®è¿½åŠ 

```python
# æ–°èªè¨¼æ–¹å¼ã®å®Ÿè£…ä¾‹
class NewAuthAdapter:
    """æ–°ã—ã„èªè¨¼æ–¹å¼ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼"""
    
    def authenticate(self, parent_window) -> bool:
        """èªè¨¼å®Ÿè¡Œ"""
        pass
    
    def is_authenticated(self) -> bool:
        """èªè¨¼çŠ¶æ…‹ç¢ºèª"""
        pass

# auth_manager.py ã§ã®çµ±åˆ
class AuthenticationManager:
    def __init__(self):
        self.auth_adapters = {
            AuthMethod.DISCORD: DiscordAuthAdapter(),
            AuthMethod.MONTHLY_PASSWORD: MonthlyAuth(),
            AuthMethod.NEW_METHOD: NewAuthAdapter(),  # æ–°æ–¹å¼è¿½åŠ 
        }
```

### æ–°ã—ã„AIæ¤œå‡ºãƒ¢ãƒ‡ãƒ«ã®è¿½åŠ 

```python
# detector.py ã§ã®æ–°ãƒ¢ãƒ‡ãƒ«çµ±åˆ
class MultiModelDetector:
    def _load_model(self, model_name: str):
        """æ–°ãƒ¢ãƒ‡ãƒ«ã®å‹•çš„èª­ã¿è¾¼ã¿"""
        if model_name == "new_model":
            return self._load_new_model()
        elif model_name.startswith("custom_"):
            return self._load_custom_model(model_name)
        else:
            return self._load_standard_model(model_name)
    
    def _load_new_model(self):
        """æ–°ã—ã„AIæ¤œå‡ºãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿"""
        # æ–°ãƒ¢ãƒ‡ãƒ«å›ºæœ‰ã®åˆæœŸåŒ–å‡¦ç†
        pass
```

### æ–°ã—ã„ãƒ¢ã‚¶ã‚¤ã‚¯åŠ¹æœã®è¿½åŠ 

```python
# mosaic.py ã§ã®æ–°åŠ¹æœè¿½åŠ 
class MosaicProcessor:
    def apply_mosaic(self, image, mask, config):
        """ãƒ¢ã‚¶ã‚¤ã‚¯é©ç”¨ã®æ‹¡å¼µ"""
        for mosaic_type, enabled in config.mosaic_types.items():
            if enabled:
                if mosaic_type == "new_effect":
                    result = self._apply_new_effect(image, mask, config)
                # æ—¢å­˜å‡¦ç†...
    
    def _apply_new_effect(self, image, mask, config):
        """æ–°ã—ã„ãƒ¢ã‚¶ã‚¤ã‚¯åŠ¹æœã®å®Ÿè£…"""
        # ã‚«ã‚¹ã‚¿ãƒ åŠ¹æœã®å‡¦ç†
        pass
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### ãƒ¡ãƒ¢ãƒªç®¡ç†

```python
# lazy_loader.py - é…å»¶èª­ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ 
class LazyModelLoader:
    """ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿"""
    
    def __init__(self):
        self._models = {}
        self._loaded_models = {}
    
    def get_model(self, model_name: str):
        """ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿"""
        if model_name not in self._loaded_models:
            self._loaded_models[model_name] = self._load_model(model_name)
        return self._loaded_models[model_name]
    
    def unload_unused_models(self):
        """æœªä½¿ç”¨ãƒ¢ãƒ‡ãƒ«ã®ãƒ¡ãƒ¢ãƒªè§£æ”¾"""
        for model_name in list(self._loaded_models.keys()):
            if not self._is_model_in_use(model_name):
                del self._loaded_models[model_name]
                gc.collect()
```

### GPUæœ€é©åŒ–

```python
# utils.py - ãƒ‡ãƒã‚¤ã‚¹æœ€é©åŒ–
def get_recommended_device(device_preference: str = "auto") -> str:
    """æœ€é©ãªãƒ‡ãƒã‚¤ã‚¹ã®è‡ªå‹•é¸æŠ"""
    if device_preference == "auto":
        if torch.cuda.is_available():
            # GPU ãƒ¡ãƒ¢ãƒªç¢ºèª
            gpu_memory = torch.cuda.get_device_properties(0).total_memory
            if gpu_memory >= 8 * 1024**3:  # 8GBä»¥ä¸Š
                return "cuda"
            else:
                return "cpu"  # GPU ãƒ¡ãƒ¢ãƒªä¸è¶³æ™‚ã¯CPUä½¿ç”¨
        else:
            return "cpu"
    return device_preference
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### çµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 

```python
# test_integrated_auth.py - çµ±åˆèªè¨¼ãƒ†ã‚¹ãƒˆ
class IntegratedAuthTest:
    """çµ±åˆèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ"""
    
    def test_developer_mode_detection(self):
        """é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰åˆ¤å®šãƒ†ã‚¹ãƒˆ"""
        # 5ã¤ã®åˆ¤å®šåŸºæº–ã®ãƒ†ã‚¹ãƒˆ
        pass
    
    def test_auth_method_switching(self):
        """èªè¨¼æ–¹å¼åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ"""
        # Discord â†” æœˆæ¬¡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        pass
    
    def test_fallback_authentication(self):
        """ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯èªè¨¼ãƒ†ã‚¹ãƒˆ"""
        # ä»£æ›¿èªè¨¼ã®å‹•ä½œç¢ºèª
        pass
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ

```python
# å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å˜ä½“ãƒ†ã‚¹ãƒˆ
test_auth_exe.py              # EXEç‰ˆèªè¨¼ãƒ†ã‚¹ãƒˆ
test_discord_auth_status.py   # Discordèªè¨¼ãƒ†ã‚¹ãƒˆ
test_nudenet_availability.py  # NudeNetå‹•ä½œãƒ†ã‚¹ãƒˆ
test_onnx_exe.py             # ONNX Runtime ãƒ†ã‚¹ãƒˆ
test_mosaic_types.py         # ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ãƒ†ã‚¹ãƒˆ
```

---

## ğŸ“ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### å‘½åè¦ç´„

```python
# ã‚¯ãƒ©ã‚¹å: PascalCase
class AuthenticationManager:
    pass

# é–¢æ•°åãƒ»å¤‰æ•°å: snake_case
def authenticate_user():
    user_name = "example"

# å®šæ•°: UPPER_SNAKE_CASE
AUTH_TIMEOUT = 30

# ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰: _ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢å§‹ã¾ã‚Š
def _internal_method(self):
    pass
```

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´„

```python
def process_image(self, image_path: str, config: ProcessingConfig) -> List[str]:
    """
    ç”»åƒã«ãƒ¢ã‚¶ã‚¤ã‚¯å‡¦ç†ã‚’é©ç”¨
    
    Args:
        image_path (str): å‡¦ç†å¯¾è±¡ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        config (ProcessingConfig): å‡¦ç†è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    
    Returns:
        List[str]: å‡¦ç†æ¸ˆã¿ç”»åƒã®å‡ºåŠ›ãƒ‘ã‚¹ãƒªã‚¹ãƒˆ
    
    Raises:
        ValueError: ç„¡åŠ¹ãªç”»åƒãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆ
        RuntimeError: AIæ¤œå‡ºå‡¦ç†ã«å¤±æ•—ã—ãŸå ´åˆ
    """
    pass
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¦ç´„

```python
# ãƒ­ã‚°å‡ºåŠ›ã®çµ±ä¸€
from auto_mosaic.src.utils import logger

try:
    result = process_data()
    logger.info("Processing completed successfully")
except ValueError as e:
    logger.error(f"Invalid input data: {e}")
    raise
except Exception as e:
    logger.error(f"Unexpected error during processing: {e}")
    # é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã§ã®ã¿è©³ç´°å‡ºåŠ›
    if is_developer_mode():
        logger.debug(traceback.format_exc())
    raise RuntimeError("Processing failed") from e
```

---

## ğŸ”® å°†æ¥ã®æ‹¡å¼µè¨ˆç”»

### çŸ­æœŸè¨ˆç”»
- **æ–°AIæ¤œå‡ºãƒ¢ãƒ‡ãƒ«çµ±åˆ**: YOLOv9ã€YOLOv10 å¯¾å¿œ
- **ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–**: SAM 2.0 çµ±åˆ
- **UI/UXæ”¹å–„**: ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã€ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ

### ä¸­æœŸè¨ˆç”»
- **ãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ**: macOSã€Linux ç‰ˆ
- **ã‚¯ãƒ©ã‚¦ãƒ‰é€£æº**: ãƒ¢ãƒ‡ãƒ«è‡ªå‹•æ›´æ–°ã€è¨­å®šåŒæœŸ
- **APIåŒ–**: REST APIã€CLI ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### é•·æœŸè¨ˆç”»
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†**: å‹•ç”»ã‚¹ãƒˆãƒªãƒ¼ãƒ å¯¾å¿œ
- **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ **: ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£æ‹¡å¼µå¯¾å¿œ
- **æ©Ÿæ¢°å­¦ç¿’å¼·åŒ–**: ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«è¨“ç·´æ©Ÿèƒ½

---

---

**ğŸ“ ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯è‡ªå‹•ãƒ¢ã‚¶ã‚¨ã‚» v1.0 ã®ã‚³ãƒ¼ãƒ‰æ§‹æˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»APIä»•æ§˜ã‚’åŒ…æ‹¬çš„ã«è§£èª¬ã—ã¦ã„ã¾ã™ã€‚**  
**ğŸ”„ æœ€çµ‚æ›´æ–°: 2025å¹´8æœˆ**  
**ğŸ“– æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯é–‹ç™ºãƒ»ä¿å®ˆãƒ»æ‹¡å¼µã«å¿…è¦ãªå…¨ã¦ã®æŠ€è¡“çš„è©³ç´°ã‚’æä¾›ã—ã¾ã™ã€‚** 